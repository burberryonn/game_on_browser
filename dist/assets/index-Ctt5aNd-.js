(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const M of s.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&c(M)}).observe(document,{childList:!0,subtree:!0});function o(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(a){if(a.ep)return;a.ep=!0;const s=o(a);fetch(a.href,s)}})();const O=document.querySelector("#game"),i=O.getContext("2d"),N=document.querySelector("[data-score]"),D=document.querySelector("[data-best]"),A=document.querySelector("[data-overlay]"),k=document.querySelector("[data-final-score]"),K=document.querySelector("[data-restart]"),b=document.querySelector("[data-start-overlay]"),x=document.querySelector("[data-pause-overlay]"),V=document.querySelector("[data-start]"),Y=document.querySelector("[data-resume]"),p=document.querySelector("[data-pause]"),P=document.querySelector("[data-mute]"),l=O.width,u=O.height,z=.35,W=-11.2,X=.55,J=.92,T=6,_=68,C=14,g=55,I=95,U=.18,Z=.22,q=(e,n,o)=>Math.min(o,Math.max(n,e)),j={static:"#111111",moving:"#2c6df2",dead:"#ff1b4b"},w=["/fx/audio_2025-09-24_18-15-46.ogg","/fx/audio_2025-09-24_18-17-15.ogg","/fx/audio_2025-09-24_18-17-37.ogg","/fx/audio_2025-09-24_18-17-45.ogg","/fx/audio_2025-09-24_18-17-52.ogg","/fx/audio_2025-09-24_18-17-56.ogg"],h=new Set,r={running:!1,paused:!1,muted:!1,score:0,best:Number(localStorage.getItem("doodle-hop-best")??"0")},t={width:42,height:54,x:l/2-21,y:u-140,vx:0,vy:0,facing:1,sprite:new Image,spriteReady:!1};t.sprite.src="/avatar.png";t.sprite.onload=()=>{t.spriteReady=!0};const f=new Audio("/music/untitled.wav");f.loop=!0;f.volume=.25;let S=!1;function m(){r.muted||S&&!f.paused||(S=!0,f.currentTime=f.currentTime||0,f.play().catch(()=>{S=!1}))}function L(e){r.muted=e,f.muted=e,e?(f.pause(),P.textContent="Sound On"):(P.textContent="Mute",m())}function Q(){if(r.muted||!w.length)return;const e=w[Math.floor(Math.random()*w.length)],n=new Audio(e);n.volume=.55,n.play().catch(()=>{})}let d=[],y=0;function F(e){const n=Math.random()<U;let o=n?"moving":"static";return!n&&Math.random()<Z&&(o="dead"),{x:Math.random()*(l-_),y:e,width:_,height:C,type:o,dx:o==="moving"?(Math.random()<.5?-1:1)*(1+Math.random()*.6):0}}function B(){d=[];let e=u-20;for(;e>-u*.5;)d.push(F(e)),e-=g+Math.random()*(I-g);const n=d[0];n.x=l/2-_/2,n.y=u-20,n.type="static",n.dx=0}function v(){N.textContent=Math.floor(r.score).toString(),D.textContent=r.best.toString()}function R(){B(),t.x=l/2-t.width/2,t.y=u-140,t.vx=0,t.vy=-8,t.facing=1,r.score=0,r.running=!0,r.paused=!1,A.hidden=!0,x.hidden=!0,b.hidden=!0,p.textContent="Pause",h.clear(),v(),m(),y=0}function $(){t.x+t.width<0?t.x=l:t.x>l&&(t.x=-42)}function tt(e){const n=t.y,o=X*e;return(h.has("ArrowLeft")||h.has("KeyA"))&&(t.vx-=o),(h.has("ArrowRight")||h.has("KeyD"))&&(t.vx+=o),t.vx*=J,t.vx=q(t.vx,-T,T),t.x+=t.vx*e*1.6,$(),t.vy+=z*e,t.y+=t.vy*e*1.6,Math.abs(t.vx)>.15&&(t.facing=t.vx>0?1:-1),n}function et(e){if(t.vy<=0)return!1;const n=e+t.height,o=t.y+t.height;for(const c of d){if(c.type==="dead")continue;const a=c.y;if(t.x+t.width>c.x&&t.x<c.x+c.width&&n<=a&&o>=a)return t.y=a-t.height,t.vy=W,!0}return!1}function ot(e){for(const o of d)o.type==="moving"&&(o.x+=o.dx*e*1.2,(o.x<0||o.x+o.width>l)&&(o.dx*=-1,o.x=q(o.x,0,l-o.width)));const n=u*.35;if(t.y<n){const o=n-t.y;t.y+=o,r.score+=o;for(const c of d)c.y+=o}for(d=d.filter(o=>o.y<u+C*2);d.length<12;){const o=d.reduce((a,s)=>Math.min(a,s.y),u),c=g+Math.random()*(I-g);d.push(F(o-c))}}function nt(){i.clearRect(0,0,l,u),i.fillStyle="#fff7d6",i.fillRect(0,0,l,u)}function rt(){for(const e of d)i.fillStyle=j[e.type],i.fillRect(e.x,e.y,e.width,e.height),i.fillStyle="#fff7d6",i.fillRect(e.x,e.y,6,e.height)}function at(){if(!t.spriteReady){i.fillStyle="#ffcb05",i.fillRect(t.x,t.y,t.width,t.height);return}i.save(),i.translate(t.x+t.width/2,t.y+t.height/2),i.scale(t.facing<0?-1:1,1),i.drawImage(t.sprite,-42/2,-54/2,t.width,t.height),i.restore()}function st(e){if(!r.running||r.paused)return;const n=tt(e);et(n)&&Q(),ot(e),t.y>u+t.height&&it()}function H(){nt(),rt(),at()}function G(e){y||(y=e);const n=Math.min((e-y)/16.67,1.6);y=e,st(n),H(),v(),requestAnimationFrame(G)}function it(){r.running=!1,r.paused=!1,r.best=Math.max(r.best,Math.floor(r.score)),localStorage.setItem("doodle-hop-best",String(r.best)),k.textContent=Math.floor(r.score).toString(),v(),x.hidden=!0,p.textContent="Pause",A.hidden=!1}function E(e){if(!r.running)return;const n=e===void 0?!r.paused:e;n!==r.paused&&(r.paused=n,x.hidden=!r.paused,r.paused?(p.textContent="Resume",f.pause(),h.clear()):(p.textContent="Pause",m(),y=0))}window.addEventListener("keydown",e=>{if(e.code==="KeyM"){L(!r.muted);return}if(e.code==="KeyP"){E();return}if(e.code==="Space"&&!r.running){m(),R();return}m(),h.add(e.code)});window.addEventListener("keyup",e=>{h.delete(e.code)});K.addEventListener("click",()=>{r.running||(m(),R())});p.addEventListener("click",()=>{E()});P.addEventListener("click",()=>{L(!r.muted)});V.addEventListener("click",()=>{m(),R()});Y.addEventListener("click",()=>{E(!1)});L(!1);B();H();v();A.hidden=!0;x.hidden=!0;b.hidden=!1;requestAnimationFrame(G);
